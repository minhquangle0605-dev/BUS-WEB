<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Homepage</title>


  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"
  />

<style>
    html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: Arial, sans-serif;
  }

  header {
    background-color: rgba(23, 233, 23, 0.7);
    color: white;
    padding: 10px 16px;
    font-size: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  header h1 {
    margin: 0;
    font-size: 18px;
  }

  #search-container {
    min-width: 220px;
    margin-left: auto;
  }
  #search-container .leaflet-control-geocoder {
    margin: 0;
  }
  #search-container .leaflet-control-geocoder-form input {
    width: 100%;
  }

  main {
    padding: 0;
    position: relative;
  }

  /* Chiều cao header + footer ~ 120px -> map dùng phần còn lại */
  #map {
    width: 100%;
    height: calc(100vh - 95px);
  }

  footer {
    background-color: rgba(23, 233, 23, 0.7);
    color: white;
    padding: 10px 16px;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    font-size: 15px;

    display: flex;
    align-items: center;
  }

  #find-route-btn {
    padding: 6px 14px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin: 0 auto;
  }
  #find-route-btn:disabled {
    background-color: #000000;
    cursor: not-allowed;
  }

  #logout-btn {
    padding: 6px 30px;
    background-color: #dc3545;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    margin-left: 0;
    margin-right: 0;
  }
</style>
</head>

<body>

  <header>
    <h1>Find your bus</h1>
    <div id="search-container"></div>
  </header>

  <main>
    <div id="map"></div>
  </main>

  <footer>
    <button id="find-route-btn" disabled>Tìm tuyến xe buýt</button>
    <button id="logout-btn">Đăng xuất</button>
  </footer>


  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

  <script>
    const map = L.map('map').setView([21.0278, 105.8342], 13);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    let markerA = null;
    let markerB = null;
    let busRouteLayer = null;

    map.on('click', function (e) {
      if (!markerA) {
        markerA = L.marker(e.latlng, { draggable: true })
          .addTo(map)
          .bindPopup('Điểm đi (A)').openPopup();
      } else if (!markerB) {
        markerB = L.marker(e.latlng, { draggable: true })
          .addTo(map)
          .bindPopup('Điểm đến (B)').openPopup();
        document.getElementById('find-route-btn').disabled = false;
      } else {
        map.removeLayer(markerA);
        map.removeLayer(markerB);
        if (busRouteLayer) {
          map.removeLayer(busRouteLayer);
          busRouteLayer = null;
        }
        markerA = markerB = null;
        document.getElementById('find-route-btn').disabled = true;
      }
    });

    const geocoderControl = L.Control.geocoder({
      defaultMarkGeocode: false,
      placeholder: 'Tìm địa điểm...',
    });

    geocoderControl.on('markgeocode', function (e) {
      const latlng = e.geocode.center;
      map.setView(latlng, 15);

      if (!markerA) {
        markerA = L.marker(latlng, { draggable: true })
          .addTo(map)
          .bindPopup(e.geocode.name)
          .openPopup();
      } else {
        markerA.setLatLng(latlng)
          .bindPopup(e.geocode.name)
          .openPopup();
      }
    });

    geocoderControl.addTo(map);
    const geocoderEl = document.querySelector('.leaflet-control-geocoder');
    document.getElementById('search-container').appendChild(geocoderEl);

    document.getElementById('find-route-btn').addEventListener('click', () => {
      if (!markerA || !markerB) return;

      const start = markerA.getLatLng();
      const end = markerB.getLatLng();

      if (busRouteLayer) {
        map.removeLayer(busRouteLayer);
      }
 //ít nữa thay api vào đây 
      busRouteLayer = L.polyline([start, end], {
        color: 'red',
        weight: 4
      }).addTo(map);

      map.fitBounds(busRouteLayer.getBounds(), { padding: [40, 40] });
    });

    document.getElementById('logout-btn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });
  </script>
</body>
</html>
